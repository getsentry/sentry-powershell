name: Setup PowerShell
description: Setup PowerShell (Core) at a given version
inputs:
  version:
    description: Powershell version to install
    required: true

runs:
  using: composite
  steps:
    # Download the powershell '.tar.gz' archive
    - run: curl -L -o /tmp/powershell.tar.gz https://github.com/PowerShell/PowerShell/releases/download/v${{ inputs.version }}/powershell-${{ inputs.version }}-linux-x64.tar.gz
      shell: bash

    # Create the target folder where powershell will be placed
    - run: sudo mkdir -p /opt/microsoft/powershell/${{ inputs.version }}
      shell: bash

    # Expand powershell to the target folder
    - run: sudo tar zxf /tmp/powershell.tar.gz -C /opt/microsoft/powershell/${{ inputs.version }}
      shell: bash

    # Set execute permissions
    - run: sudo chmod +x /opt/microsoft/powershell/${{ inputs.version }}/pwsh
      shell: bash

    # Create the symbolic link that points to pwsh
    - run: sudo ln -s /opt/microsoft/powershell/${{ inputs.version }}/pwsh /usr/bin/pwsh
      shell: bash
